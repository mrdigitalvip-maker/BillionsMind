<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>BillionMind AI ‚Äì Disciplina, Dinheiro e Lifestyle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Um √∫nico chat para organizar disciplina, dinheiro e lifestyle em 30 dias de alta performance." />

  <!-- Open Graph / compartilhamento -->
  <meta property="og:title" content="BillionMind AI ‚Äì Seu chat de disciplina, dinheiro e lifestyle" />
  <meta property="og:description" content="Use a IA para montar metas di√°rias, planos de 30 dias e ideias de renda extra guiadas." />
  <!-- Ajuste a URL do √≠cone se voc√™ subir em outro caminho -->
  <meta property="og:image" content="https://billions-mind.vercel.app/icon.png" />
  <meta property="og:url" content="https://billions-mind.vercel.app" />
  <meta name="twitter:card" content="summary_large_image" />

  <link rel="icon" href="/icon.png" type="image/png" />

  <style>
    :root {
      --bg-main: #06070b;
      --bg-card: #0c0f18;
      --bg-gradient: radial-gradient(circle at top left, #2c3a4f, #05060a);
      --gold: #ffc34d;
      --gold-soft: #ffb642;
      --gold-deep: #ff9f1c;
      --accent-green: #21c45c;
      --accent-blue: #3c8dff;
      --text-main: #f8f8f8;
      --text-soft: #c7ccdd;
      --text-muted: #9aa0b3;
      --border-soft: rgba(255, 255, 255, 0.06);
      --shadow-main: 0 24px 60px rgba(0, 0, 0, 0.65);
      --radius-xl: 26px;
      --radius-lg: 20px;
      --radius-md: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Inter", sans-serif;
      background: radial-gradient(circle at top, #0c111c, #020308);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 16px 0 80px;
    }

    .app-shell {
      width: 100%;
      max-width: 480px;
      background: linear-gradient(180deg, #05060b 0%, #05060b 40%, #080a11 100%);
      border-radius: 32px;
      box-shadow: var(--shadow-main);
      padding: 12px 12px 80px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    /* topo */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .branding {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fff7e0, #ffb642 45%, #a06912 80%);
      box-shadow: 0 0 18px rgba(255, 182, 66, 0.65);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .logo-circle::after {
      content: "";
      width: 40%;
      height: 40%;
      border-radius: 50%;
      background: #000;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-name {
      letter-spacing: 0.4em;
      font-size: 0.64rem;
      text-transform: uppercase;
      color: #cfd4e6;
    }

    .brand-sub {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .tag-online {
      font-size: 0.7rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(33, 196, 92, 0.4);
      color: var(--accent-green);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at left, rgba(33, 196, 92, 0.08), transparent 60%);
    }

    .tag-online-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent-green);
      box-shadow: 0 0 10px rgba(33, 196, 92, 0.9);
    }

    /* hero card */
    .hero-card {
      margin-top: 4px;
      padding: 18px 16px 18px;
      border-radius: var(--radius-xl);
      background: var(--bg-gradient);
      border: 1px solid rgba(255, 255, 255, 0.06);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
    }

    .hero-badges {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .badge-pill {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      color: var(--text-soft);
      background: rgba(6, 8, 15, 0.75);
    }

    .badge-pill.gold {
      border-color: rgba(255, 195, 77, 0.7);
      background: linear-gradient(90deg, rgba(255, 195, 77, 0.16), rgba(255, 159, 28, 0.3));
      color: #1f1407;
      font-weight: 600;
    }

    .hero-title {
      font-size: 1.2rem;
      line-height: 1.35;
      margin-bottom: 6px;
    }

    .hero-title span {
      color: var(--gold);
    }

    .hero-text {
      font-size: 0.85rem;
      color: var(--text-soft);
      margin-bottom: 14px;
    }

    .hero-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 10px;
    }

    .btn-main {
      border: none;
      border-radius: 999px;
      padding: 11px 16px;
      font-size: 0.92rem;
      font-weight: 600;
      cursor: pointer;
      background: radial-gradient(circle at 20% 0%, #fff0c2, #ffb642 45%, #ff9f1c 100%);
      color: #261707;
      box-shadow: 0 16px 35px rgba(255, 182, 66, 0.65);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    .btn-main:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 22px 45px rgba(255, 182, 66, 0.8);
    }

    .btn-ghost {
      border-radius: 999px;
      padding: 9px 14px;
      border: 1px solid rgba(221, 227, 255, 0.35);
      background: rgba(5, 9, 18, 0.9);
      color: var(--text-soft);
      font-size: 0.82rem;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: background 0.15s ease, border 0.15s ease;
    }

    .btn-ghost:hover {
      background: rgba(18, 24, 37, 0.95);
      border-color: rgba(255, 255, 255, 0.55);
    }

    .hero-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .chip {
      font-size: 0.75rem;
      padding: 5px 9px;
      border-radius: 999px;
      background: rgba(6, 10, 18, 0.85);
      border: 1px solid rgba(205, 215, 255, 0.35);
      color: var(--text-soft);
    }

    .chip.gold {
      border-color: rgba(255, 195, 77, 0.7);
      color: var(--gold);
      background: rgba(11, 8, 3, 0.9);
    }

    /* CTA plano completo */
    .plan-cta {
      margin-top: 20px;
      padding: 16px 14px;
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at top left, rgba(255, 199, 95, 0.16), transparent 60%),
                  rgba(7, 8, 14, 0.96);
      border: 1px solid rgba(255, 199, 95, 0.25);
      color: var(--text-main);
    }

    .plan-cta h3 {
      margin: 0 0 4px;
      font-size: 0.98rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--gold);
    }

    .plan-cta p {
      margin: 0 0 10px;
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    .btn-assinar {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 9px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.86rem;
      background: linear-gradient(90deg, #ffc34d, #ff9f1c);
      box-shadow: 0 0 18px rgba(255, 184, 77, 0.35);
      color: #1a1308;
      transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease;
    }

    .btn-assinar:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 26px rgba(255, 184, 77, 0.55);
      filter: brightness(1.05);
    }

    .plan-cta small {
      display: block;
      margin-top: 6px;
      font-size: 0.73rem;
      color: var(--text-muted);
    }

    /* √°reas (Home / Chat / Hist√≥rico / Imagens / Planos) */

    .section {
      margin-top: 16px;
      border-radius: var(--radius-xl);
      background: rgba(7, 9, 16, 0.96);
      border: 1px solid var(--border-soft);
      padding: 14px 12px 14px;
      display: none;
    }

    .section.active {
      display: block;
    }

    .section-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .section-title {
      font-size: 0.82rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .section-tag {
      font-size: 0.72rem;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(11, 179, 93, 0.07);
      color: var(--accent-green);
      border: 1px solid rgba(11, 179, 93, 0.45);
    }

    /* chat */

    .chat-thread {
      background: #050711;
      border-radius: var(--radius-lg);
      padding: 12px 12px 10px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      max-height: 260px;
      overflow-y: auto;
    }

    .msg {
      margin-bottom: 10px;
      font-size: 0.86rem;
      line-height: 1.45;
    }

    .msg-label {
      font-weight: 600;
    }

    .msg-assistant .msg-label {
      color: var(--gold);
    }

    .msg-user .msg-label {
      color: var(--accent-blue);
    }

    .msg-bubble {
      margin-top: 2px;
      padding: 8px 10px;
      border-radius: 12px;
    }

    .msg-assistant .msg-bubble {
      background: linear-gradient(135deg, #050814, #050914);
      border: 1px solid rgba(255, 255, 255, 0.04);
      color: var(--text-soft);
    }

    .msg-user .msg-bubble {
      background: rgba(30, 68, 170, 0.22);
      border: 1px solid rgba(96, 158, 255, 0.45);
      color: #deebff;
    }

    .chat-input-area {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .chat-input-row {
      display: flex;
      gap: 8px;
      align-items: center;
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.02), transparent 60%),
                  #040611;
      border-radius: 999px;
      padding: 6px 6px 6px 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .chat-input {
      flex: 1;
      border: none;
      background: transparent;
      color: var(--text-main);
      font-size: 0.86rem;
      outline: none;
    }

    .chat-input::placeholder {
      color: var(--text-muted);
    }

    .btn-send {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: radial-gradient(circle at 20% 0%, #fff1c7, #ffb642 45%, #ff9f1c 100%);
      box-shadow: 0 6px 14px rgba(255, 184, 77, 0.7);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      color: #261707;
      flex-shrink: 0;
    }

    .chat-hint {
      font-size: 0.74rem;
      color: var(--text-muted);
      margin-left: 6px;
      margin-top: -2px;
    }

    /* hist√≥rico */

    .history-empty {
      font-size: 0.82rem;
      color: var(--text-muted);
      padding: 10px 4px;
    }

    /* imagens */

    .images-controls {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 8px;
    }

    .images-prompt {
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.08);
      padding: 8px 10px;
      font-size: 0.84rem;
      background: #050814;
      color: var(--text-main);
      outline: none;
    }

    .images-prompt::placeholder {
      color: var(--text-muted);
    }

    .btn-generate-img {
      align-self: flex-end;
      border-radius: 999px;
      border: none;
      padding: 7px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      color: #100805;
      background: linear-gradient(90deg, #ffc34d, #ff9f1c);
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(255, 184, 77, 0.6);
    }

    .images-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .images-grid img {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .images-empty {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* planos (texto explicando Free / Pro / Premium) */

    .plans-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-size: 0.84rem;
    }

    .plan-card {
      border-radius: var(--radius-md);
      padding: 10px 10px 9px;
      background: radial-gradient(circle at top left, rgba(255, 199, 95, 0.08), transparent 60%),
                  #050814;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .plan-card h4 {
      margin-bottom: 4px;
      font-size: 0.88rem;
    }

    .plan-pill {
      font-size: 0.74rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.5);
      color: var(--text-soft);
      border: 1px solid rgba(255, 255, 255, 0.12);
      display: inline-block;
      margin-bottom: 4px;
    }

    .plan-highlight {
      color: var(--gold);
      font-weight: 600;
    }

    /* bottom nav */

    .bottom-nav {
      position: absolute;
      left: 14px;
      right: 14px;
      bottom: 14px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #101321, #05060a);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 18px 44px rgba(0, 0, 0, 0.85);
      padding: 6px 8px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 10;
    }

    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      padding: 6px 4px;
      border-radius: 999px;
      color: var(--text-muted);
      font-size: 0.7rem;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease;
    }

    .nav-item span {
      font-size: 0.95rem;
    }

    .nav-item.active {
      background: radial-gradient(circle at top, rgba(255, 195, 77, 0.24), rgba(0, 0, 0, 0));
      color: var(--gold);
    }

    .nav-label {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    @media (max-width: 520px) {
      body {
        padding: 0;
        background: #020308;
      }
      .app-shell {
        border-radius: 0;
        max-width: 100%;
        height: 100vh;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- topo -->
    <header class="app-header">
      <div class="branding">
        <div class="logo-circle"></div>
        <div class="brand-text">
          <div class="brand-name">BILLIONMIND</div>
          <div class="brand-sub">AI ¬∑ disciplina ¬∑ renda extra ¬∑ lifestyle</div>
        </div>
      </div>
      <div class="tag-online">
        <span class="tag-online-dot"></span>
        Chat liberado
      </div>
    </header>

    <!-- HERO / HOME -->
    <section id="screen-home">
      <div class="hero-card">
        <div class="hero-badges">
          <div class="badge-pill gold">Conta Free ¬∑ 3 testes por dia</div>
          <div class="badge-pill">Vers√£o completa ativa</div>
        </div>

        <h1 class="hero-title">
          Um √∫nico chat para organizar
          <span>disciplina, dinheiro e lifestyle</span>.
        </h1>
        <p class="hero-text">
          Escreva como voc√™ quer viver e deixe a IA montar metas di√°rias, planos
          de 30 dias e ideias de renda extra guiadas ‚Äì sem bagun√ßar sua mente.
        </p>

        <div class="hero-actions">
          <button class="btn-main" id="btnComecarAgora">
            Come√ßar sess√£o agora
          </button>
          <button class="btn-ghost" id="btnVerPlanos">
            Ver planos e benef√≠cios
          </button>
        </div>

        <div class="hero-tags">
          <span class="chip gold">30 dias guiados</span>
          <span class="chip">Plano do dia autom√°tico</span>
          <span class="chip">Renda extra inteligente</span>
          <span class="chip">Estilo de vida sem bagun√ßa mental</span>
        </div>

        <!-- CTA ASSINATURA -->
        <div class="plan-cta">
          <h3>Plano completo BillionMind AI</h3>
          <p>
            Libere acesso ilimitado ao chat de alta performance, sequ√™ncia guiada
            de 30 dias, ideias de renda extra e cria√ß√£o de imagens de lifestyle
            personalizadas.
          </p>
          <button id="btnAssinarPlano" class="btn-assinar">
            Assinar plano completo
          </button>
          <small>Pagamento seguro via Stripe ¬∑ assinatura mensal</small>
        </div>
      </div>

      <!-- Se√ß√£o home extra: texto de modo atual -->
      <div class="section active" id="section-home-extra">
        <div class="section-title-row">
          <div class="section-title">Sess√£o BillionMind AI</div>
          <div class="section-tag">Modo disciplina + renda extra</div>
        </div>
        <p style="font-size:0.86rem; color:var(--text-soft);">
          Hoje voc√™ est√° em uma conta Free com <span style="color:var(--gold);font-weight:600;">3 testes por dia</span>.  
          Cada sess√£o pode ser usada para organizar metas, rotina e ideias de renda extra
          sem travar o restante do seu dia.
        </p>
      </div>
    </section>

    <!-- CHAT -->
    <section class="section" id="screen-chat">
      <div class="section-title-row">
        <div class="section-title">Chat ‚Ä¢ Alta performance</div>
        <div class="section-tag">Guia de 30 dias</div>
      </div>
      <div class="chat-thread" id="chatThread">
        <div class="msg msg-assistant">
          <div class="msg-label">BillionMind:</div>
          <div class="msg-bubble">
            Me conte em uma frase como voc√™ quer estar em 30 dias
            (disciplina, dinheiro e lifestyle).  
            Vou montar o foco de hoje e os pr√≥ximos passos.
          </div>
        </div>
      </div>
      <div class="chat-input-area">
        <div class="chat-input-row">
          <input
            id="chatInput"
            class="chat-input"
            type="text"
            placeholder="Ex.: Quero 30 dias de disciplina e renda extra √† noite‚Ä¶"
          />
          <button class="btn-send" id="btnSendMsg">‚û§</button>
        </div>
        <div class="chat-hint">
          Dica: quanto mais espec√≠fico voc√™ for (hor√°rio, objetivo, valor em dinheiro),
          mais forte ser√° a sess√£o.
        </div>
      </div>
    </section>

    <!-- HIST√ìRICO -->
    <section class="section" id="screen-history">
      <div class="section-title-row">
        <div class="section-title">Hist√≥rico</div>
        <div class="section-tag">Suas sess√µes</div>
      </div>
      <div id="historyList" class="history-empty">
        Quando voc√™ usar o chat, seus √∫ltimos focos de 30 dias ir√£o aparecer aqui.
      </div>
    </section>

    <!-- IMAGENS -->
    <section class="section" id="screen-images">
      <div class="section-title-row">
        <div class="section-title">Imagens</div>
        <div class="section-tag">Lifestyle guiado</div>
      </div>
      <div class="images-controls">
        <input
          type="text"
          id="imagePrompt"
          class="images-prompt"
          placeholder="Descreva uma imagem de lifestyle que combine com sua meta (ex.: garagem de luxo com carro esportivo e foco noturno)‚Ä¶"
        />
        <button class="btn-generate-img" id="btnGenerateImage">
          Criar imagem com IA
        </button>
      </div>
      <div id="imagesGrid" class="images-grid">
        <!-- imagens do Supabase / API ser√£o listadas aqui -->
      </div>
      <div id="imagesEmpty" class="images-empty" style="display:none;">
        Assim que criar sua primeira imagem, ela aparece aqui.
      </div>
    </section>

    <!-- PLANOS -->
    <section class="section" id="screen-plans">
      <div class="section-title-row">
        <div class="section-title">Planos & Assinaturas</div>
        <div class="section-tag">Upgrade em breve</div>
      </div>
      <div class="plans-list">
        <div class="plan-card">
          <span class="plan-pill">Conta Free</span>
          <h4>3 testes por dia</h4>
          <p>
            Ideal para experimentar o fluxo do BillionMind AI: um foco por dia,
            vis√£o de 30 dias e algumas ideias de renda extra para testar.
          </p>
        </div>
        <div class="plan-card">
          <span class="plan-pill">Plano Completo</span>
          <h4><span class="plan-highlight">Acesso ilimitado ao chat</span></h4>
          <p>
            Sess√µes di√°rias ilimitadas, plano guiado completo, hist√≥rico salvo,
            imagens de lifestyle liberadas e prioridade nas respostas.
          </p>
          <button class="btn-assinar" id="btnAssinarPlano2" style="margin-top:6px;">
            Assinar plano completo
          </button>
        </div>
        <div class="plan-card">
          <span class="plan-pill">B√¥nus</span>
          <h4>Modo renda extra guiada</h4>
          <p>
            Perguntas espec√≠ficas sobre sua rotina, tempo dispon√≠vel e recursos.
            A IA devolve ideias de renda extra com passos pr√°ticos e metas di√°rias.
          </p>
        </div>
      </div>
    </section>

    <!-- bottom nav -->
    <nav class="bottom-nav">
      <div class="nav-item active" data-screen="home">
        <span>üè†</span>
        <div class="nav-label">Home</div>
      </div>
      <div class="nav-item" data-screen="chat">
        <span>üí¨</span>
        <div class="nav-label">Chat</div>
      </div>
      <div class="nav-item" data-screen="history">
        <span>üìú</span>
        <div class="nav-label">Hist√≥rico</div>
      </div>
      <div class="nav-item" data-screen="images">
        <span>üñºÔ∏è</span>
        <div class="nav-label">Imagens</div>
      </div>
      <div class="nav-item" data-screen="plans">
        <span>üí≥</span>
        <div class="nav-label">Planos</div>
      </div>
    </nav>
  </div>

  <script>
    // ---- Navega√ß√£o inferior ----
    const navItems = document.querySelectorAll(".nav-item");
    const screenHome = document.getElementById("screen-home");
    const screenChat = document.getElementById("screen-chat");
    const screenHistory = document.getElementById("screen-history");
    const screenImages = document.getElementById("screen-images");
    const screenPlans = document.getElementById("screen-plans");

    function showScreen(target) {
      screenHome.style.display = target === "home" ? "block" : "none";
      screenChat.classList.toggle("active", target === "chat");
      screenHistory.classList.toggle("active", target === "history");
      screenImages.classList.toggle("active", target === "images");
      screenPlans.classList.toggle("active", target === "plans");

      navItems.forEach((item) => {
        item.classList.toggle("active", item.dataset.screen === target);
      });
    }

    navItems.forEach((item) => {
      item.addEventListener("click", () => {
        showScreen(item.dataset.screen);
      });
    });

    // home aparece por padr√£o
    showScreen("home");

    // atalhos dos bot√µes do hero
    document.getElementById("btnComecarAgora").addEventListener("click", () => {
      showScreen("chat");
      document.getElementById("chatInput").focus();
    });

    document.getElementById("btnVerPlanos").addEventListener("click", () => {
      showScreen("plans");
    });

    // ---- Chat b√°sico chamando sua API backend (/api/chat) ----
    const chatThread = document.getElementById("chatThread");
    const chatInput = document.getElementById("chatInput");
    const btnSendMsg = document.getElementById("btnSendMsg");

    async function sendMessage() {
      const text = chatInput.value.trim();
      if (!text) return;

      // exibe mensagem do usu√°rio
      const userMsg = document.createElement("div");
      userMsg.className = "msg msg-user";
      userMsg.innerHTML =
        '<div class="msg-label">Voc√™:</div><div class="msg-bubble"></div>';
      userMsg.querySelector(".msg-bubble").textContent = text;
      chatThread.appendChild(userMsg);
      chatThread.scrollTop = chatThread.scrollHeight;
      chatInput.value = "";

      // chama sua API backend (j√° criada em /api/chat.js)
      try {
        const response = await fetch("/api/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text }),
        });
        const data = await response.json();

        const replyText = data.reply || "N√£o consegui responder agora. Tente novamente.";
        const botMsg = document.createElement("div");
        botMsg.className = "msg msg-assistant";
        botMsg.innerHTML =
          '<div class="msg-label">BillionMind:</div><div class="msg-bubble"></div>';
        botMsg.querySelector(".msg-bubble").textContent = replyText;
        chatThread.appendChild(botMsg);
        chatThread.scrollTop = chatThread.scrollHeight;
      } catch (e) {
        console.error(e);
        const botMsg = document.createElement("div");
        botMsg.className = "msg msg-assistant";
        botMsg.innerHTML =
          '<div class="msg-label">BillionMind:</div><div class="msg-bubble"></div>';
        botMsg.querySelector(".msg-bubble").textContent =
          "Houve um erro de conex√£o com o servidor. Tente novamente em instantes.";
        chatThread.appendChild(botMsg);
        chatThread.scrollTop = chatThread.scrollHeight;
      }
    }

    btnSendMsg.addEventListener("click", sendMessage);
    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        sendMessage();
      }
    });

    // ---- Hist√≥rico (GET /api/history se existir) ----
    async function loadHistory() {
      const historyList = document.getElementById("historyList");
      try {
        const res = await fetch("/api/history");
        if (!res.ok) return;
        const data = await res.json();
        if (!data.items || !data.items.length) return;

        historyList.classList.remove("history-empty");
        historyList.innerHTML = "";
        data.items.forEach((item) => {
          const div = document.createElement("div");
          div.style.marginBottom = "8px";
          div.style.padding = "6px 4px";
          div.style.borderBottom = "1px solid rgba(255,255,255,0.04)";
          div.style.fontSize = "0.82rem";
          div.innerHTML =
            "<strong>Dia " +
            (item.day || "?") +
            ":</strong> " +
            (item.summary || item.prompt || "");
          historyList.appendChild(div);
        });
      } catch (err) {
        console.error("Erro ao carregar hist√≥rico", err);
      }
    }

    // carrega hist√≥rico quando o usu√°rio abrir a aba
    screenHistory.addEventListener("transitionend", loadHistory);
    // tamb√©m tenta uma vez ao carregar
    loadHistory();

    // ---- Imagens (POST /api/image e GET /api/images) ----
    const btnGenerateImage = document.getElementById("btnGenerateImage");
    const imagePrompt = document.getElementById("imagePrompt");
    const imagesGrid = document.getElementById("imagesGrid");
    const imagesEmpty = document.getElementById("imagesEmpty");

    async function loadImages() {
      try {
        const res = await fetch("/api/images");
        if (!res.ok) return;
        const data = await res.json();
        imagesGrid.innerHTML = "";
        if (!data.items || !data.items.length) {
          imagesEmpty.style.display = "block";
          return;
        }
        imagesEmpty.style.display = "none";
        data.items.forEach((img) => {
          const el = document.createElement("img");
          el.src = img.url;
          el.alt = img.prompt || "Imagem BillionMind";
          imagesGrid.appendChild(el);
        });
      } catch (err) {
        console.error("Erro ao carregar imagens", err);
      }
    }

    btnGenerateImage.addEventListener("click", async () => {
      const prompt = imagePrompt.value.trim();
      if (!prompt) {
        alert("Descreva a imagem que voc√™ quer criar.");
        return;
      }
      btnGenerateImage.disabled = true;
      btnGenerateImage.textContent = "Gerando imagem‚Ä¶";

      try {
        const res = await fetch("/api/image", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt }),
        });
        const data = await res.json();
        if (!res.ok) {
          alert(data.error || "Erro ao gerar imagem.");
        } else {
          imagePrompt.value = "";
          await loadImages();
        }
      } catch (err) {
        console.error(err);
        alert("Erro de conex√£o ao gerar imagem.");
      } finally {
        btnGenerateImage.disabled = false;
        btnGenerateImage.textContent = "Criar imagem com IA";
      }
    });

    // tenta carregar imagens ao abrir a aba Imagens
    screenImages.addEventListener("transitionend", loadImages);
    loadImages();

    // ---- Stripe ‚Äì Assinatura (usa /api/create-checkout-session) ----
    async function iniciarCheckoutStripe() {
      const btns = [document.getElementById("btnAssinarPlano"), document.getElementById("btnAssinarPlano2")].filter(Boolean);
      btns.forEach((b) => {
        b.disabled = true;
        b.textContent = "Redirecionando‚Ä¶";
      });

      try {
        const response = await fetch("/api/create-checkout-session", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        });
        const data = await response.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          alert("N√£o foi poss√≠vel iniciar o pagamento. Tente novamente.");
        }
      } catch (err) {
        console.error(err);
        alert("Erro de conex√£o ao criar o pagamento.");
      } finally {
        btns.forEach((b) => {
          b.disabled = false;
          b.textContent = "Assinar plano completo";
        });
      }
    }

    const btnAssinar1 = document.getElementById("btnAssinarPlano");
    const btnAssinar2 = document.getElementById("btnAssinarPlano2");
    if (btnAssinar1) btnAssinar1.addEventListener("click", iniciarCheckoutStripe);
    if (btnAssinar2) btnAssinar2.addEventListener("click", iniciarCheckoutStripe);
  </script>
</body>
</html>
