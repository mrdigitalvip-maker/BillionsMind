<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BillionMind AI</title>

<style>
body{
  margin:0;background:#0b0b0f;color:white;
  font-family:Arial, sans-serif;overflow-x:hidden;
}
#appHeader{
  position:fixed;top:0;width:100%;padding:15px;
  text-align:center;background:rgba(10,10,14,0.65);
  backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,215,0,0.2);
  font-size:20px;color:#ffd700;font-weight:bold;z-index:1000;
}
.page{display:none;padding:90px 20px 80px 20px;}
.activePage{display:block;}
.card{
  background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);
  padding:18px;border-radius:18px;margin-bottom:18px;
  backdrop-filter:blur(12px);
}
.titulo{font-size:22px;font-weight:bold;color:#ffd700;}
.sub{opacity:.7;font-size:14px;margin-top:4px;}
#bottomMenu{
  position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;
  background:rgba(10,10,14,0.85);backdrop-filter:blur(12px);
  border-top:1px solid rgba(255,255,255,0.1);padding:10px 0;z-index:1000;
}
#bottomMenu div{font-size:13px;color:#bbb;text-align:center;cursor:pointer;}
#bottomMenu .active{color:#ffd700;font-weight:bold;}

#chatWindow{
  height:63vh;overflow-y:auto;padding:10px;border-radius:15px;
  background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);
}
.chatMsgUser{
  background:#2f6bff;padding:12px;border-radius:12px;margin-bottom:10px;
  max-width:80%;color:white;
}
.chatMsgAI{
  background:#15171d;padding:12px;border-radius:12px;margin-bottom:10px;
  border:1px solid rgba(255,215,0,0.15);max-width:80%;
}
#chatInputBox{display:flex;gap:10px;margin-top:10px;}
#chatInput{
  flex:1;padding:12px;border-radius:10px;border:none;
  background:#1b1e26;color:white;
}
#sendBtn{
  background:#ffd700;border:none;padding:12px 16px;border-radius:10px;
  cursor:pointer;
}

</style>
</head>
<body>

<div id="appHeader">BillionMind AI</div>

<!-- DASHBOARD -->
<div id="pageDashboard" class="page activePage">
  <div class="card">
    <div class="titulo">Bem-vindo √† sua nova mente</div>
    <div class="sub">Comece pelo menu abaixo</div>
  </div>

  <div class="card">
    <div class="titulo">Meta do dia</div>
    <div class="sub">Trabalhar 90 minutos focado em 1 objetivo.</div>
  </div>

  <div class="card">
    <div class="titulo">Seu progresso</div>
    <div class="sub">Painel em constru√ß√£o ‚Äî ser√° salvo no Supabase.</div>
  </div>
</div>

<!-- CHAT -->
<div id="pageChat" class="page">
  <div id="chatWindow"></div>

  <div id="chatInputBox">
    <input id="chatInput" placeholder="Escreva sua mensagem...">
    <button id="sendBtn" onclick="sendChatMessage()">‚û§</button>
  </div>
</div>

<!-- HIST√ìRICO -->
<div id="pageHistorico" class="page">
  <div class="card">
    <div class="titulo">Hist√≥rico</div>
    <div class="sub">Carregando conversas...</div>
  </div>
  <div id="histList"></div>
</div>

<!-- PERFIL -->
<div id="pagePerfil" class="page">
  <div class="card">
    <div class="titulo">Sua conta</div>
    <div class="sub">Abaixo os dados do usu√°rio</div>
  </div>
  <div class="card">
    <div id="perfilInfo">Voc√™ n√£o est√° logado.</div>
  </div>
  <button onclick="logout()" style="
    margin-top:20px;width:100%;padding:14px;border:none;
    background:#ffd700;color:#000;border-radius:10px;font-weight:bold;">
    Sair
  </button>
</div>

<!-- MENU INFERIOR -->
<div id="bottomMenu">
  <div onclick="openPage('Dashboard')" class="active">üè†<br>Home</div>
  <div onclick="openPage('Chat')">üí¨<br>Chat</div>
  <div onclick="openPage('Historico')">üìú<br>Hist√≥rico</div>
  <div onclick="openPage('Perfil')">üë§<br>Perfil</div>
</div>

<!-- SCRIPTS -->
<script>
function openPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('activePage'));
  document.querySelector('#page'+name).classList.add('activePage');
  
  document.querySelectorAll('#bottomMenu div').forEach(d=>d.classList.remove('active'));
  event.target.classList.add('active');
}

/* ---------------- LOGIN ---------------- */
let USER = null;

async function login(){
  const email = prompt("E-mail:");
  const senha = prompt("Senha:");

  const res = await fetch("/api/login",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({email, senha})
  });
  const data = await res.json();

  if(data.error){ alert("Erro: "+data.error); return; }

  USER = data.user;
  localStorage.setItem("bm_user_id", USER.id);
  alert("Login feito!");
  loadPerfil();
}

function logout(){
  USER = null;
  localStorage.removeItem("bm_user_id");
  alert("Desconectado.");
  document.getElementById("perfilInfo").innerText="Voc√™ n√£o est√° logado.";
}

/* ---------------- PERFIL ---------------- */
function loadPerfil(){
  const uid = localStorage.getItem("bm_user_id");
  if(!uid){
    document.getElementById("perfilInfo").innerText="Voc√™ n√£o est√° logado.";
    return;
  }
  document.getElementById("perfilInfo").innerHTML = `
    <b>ID:</b> ${uid}<br>
    <b>Status:</b> Logado
  `;
}

/* ---------------- CHAT ---------------- */
async function sendChatMessage(){
  const input=document.getElementById("chatInput");
  const text=input.value.trim();
  if(!text)return;

  const chat=document.getElementById("chatWindow");

  let u=document.createElement("div");
  u.className="chatMsgUser";
  u.innerText=text;
  chat.appendChild(u);

  input.value="";

  let loading=document.createElement("div");
  loading.className="chatMsgAI";
  loading.innerText="Pensando...";
  chat.appendChild(loading);

  const res = await fetch("/api/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:text})
  });

  const data=await res.json();
  loading.remove();

  let ai=document.createElement("div");
  ai.className="chatMsgAI";
  ai.innerText=data.reply || "Erro ao responder.";
  chat.appendChild(ai);

  chat.scrollTop=chat.scrollHeight;
}

loadPerfil();
</script>

<button onclick="login()" style="
position:fixed;top:80px;right:20px;z-index:2000;
padding:10px 15px;background:#ffd700;color:#000;
border:none;border-radius:10px;font-weight:bold;">
Login
</button>

</body>
</html>
